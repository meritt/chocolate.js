((function(){var a,b,c,d,e,f,g,h,i=Object.prototype.hasOwnProperty,j=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(i.call(this,b)&&this[b]===a)return b;return-1};h={overlay:'<div class="sgl-overlay">  <div class="sgl-leftside"></div>  {{spinner}}  <div class="sgl-container"></div>  <div class="sgl-rightside"></div>  {{thumbnails}}  <div class="sgl-close"></div></div>',spinner:'<div class="sgl-spinner"> <img src="../themes/default/images/spinner-bg.png" alt=""> <img src="../themes/default/images/spinner-serenity.png" alt=""></div>',thumbnails:'<div class="sgl-thumbnails-toggle"></div><div class="sgl-thumbnails"></div>',thumbnail:'<div class="sgl-thumbnail{{selected}}" data-cid="{{cid}}" style="background-image:url(\'{{thumbnail}}\')"{{title}}></div>',header:'<div class="sgl-header"><h1>{{title}}</h1></div>',hover:'<span class="sgl-item-hover" data-sglid="{{cid}}"></span>'},c=0,f="next",g="prev",b="close",d=[f,g,b],e=!!window.history&&!!history.pushState,a=function(){function a(a,b){var c,d,f,g,i,j,k,l,m=this;b&&typeof b=="object"&&(this.options=$.extend(this.options,b)),this.options.history||(e=!1),f=h.overlay,f=f.replace("{{spinner}}",h.spinner),f=f.replace("{{thumbnails}}",this.options.thumbnails?h.thumbnails:""),this.overlay=$(f).appendTo("body"),d=["container","spinner","leftside","rightside"],this.options.thumbnails&&d.push("thumbnails");for(g=0,j=d.length;g<j;g++)c=d[g],this[c]=this.overlay.find(".sgl-"+c);this.overlay.find(".sgl-close").click(function(a){return m.close()}),l=["overlay","container","leftside","rightside"];for(i=0,k=l.length;i<k;i++)c=l[i],this._prepareActionFor(c);e&&$(window).bind("popstate",function(a){var b;b=m.getImageFromUri();if(b>0&&b!==m.current)return m.current===null?m.show(b):m.updateImage(b,!1)}),$(window).bind("keyup",function(a){if(m.overlay.hasClass("show"))switch(a.keyCode){case 27:return m.close();case 37:return m.prev();case 39:return m.next()}}),a&&this.add(a)}return a.prototype.images={},a.prototype.current=null,a.prototype.options={actions:{overlay:!1,leftside:g,container:f,rightside:b},thumbnails:!0,history:!0},a.prototype._prepareActionFor=function(a){var b,c,e,f=this;return b=(e=this.options.actions[a],j.call(d,e)>=0)?this.options.actions[a]:!1,b&&(c=this[a].attr("class"),this[a].click(function(a){if($(a.target).hasClass(c))return f[b]()})),this},a.prototype.getImageFromUri=function(){var a;return a=window.location.hash,a?parseInt(a.replace("#image",""),10):0},a.prototype.add=function(a){var b,c,d,e;if(!a||a.length===0)return this;for(d=0,e=a.length;d<e;d++)c=a[d],b=null,c instanceof HTMLElement&&(b=$(c),c={source:b.attr("data-src")||b.parent().attr("href"),title:b.attr("data-title")||b.attr("title"),thumbnail:b.attr("src")}),this._addToGallery(c,b);return this},a.prototype._addToGallery=function(a,b){var d,e,f,g=this;if(!a.source)return;d=++c,a.thumbnail||(a.thumbnail=a.source),this.images[d]=a;if(b)return f=function(a,b){return a.stopPropagation(),a.preventDefault(),g.show(b)},b.addClass("sgl-item").click(function(a){return f(a,d)}),e=new Image,e.src=a.thumbnail,e.onload=function(a){return b.before(h.hover.replace("{{cid}}",d)),$("[data-sglid="+d+"]").css({width:b.width(),height:b.height()}).click(function(a){return f(a,d)})}},a.prototype.show=function(a){a==null&&(a=this.getImageFromUri()),a<=0&&(a=1);if(this.images[a]==null)throw"Image not found";return this.current===null&&(this.current=a),this.options.thumbnails&&this.createThumbnails(),this.updateImage(a),this.overlay.addClass("show"),this},a.prototype.close=function(){return this.overlay.removeClass("show"),this},a.prototype.next=function(){var a;return a=this.current+1,this.images[a]!=null&&this.updateImage(a),this},a.prototype.prev=function(){var a;return a=this.current-1,this.images[a]!=null&&this.updateImage(a),this},a.prototype.updateImage=function(a,b){var c;return b==null&&(b=!0),this.current=a,this.container.removeClass("show"),this.options.thumbnails&&(this.thumbnails.find(".selected").removeClass("selected"),this.thumbnails.find("[data-cid="+a+"]").addClass("selected")),e&&b&&(c=this.images[a].title?"Image: "+this.images[a].title:null,history.pushState(null,c,"#image"+a)),this.getImageSize(a,function(a){var b;return this.container.addClass("show"),b=this.images[a],this.updateDimensions(b.width,b.height),this.container.css("background-image","url("+b.source+")"),this.container.html(b.title?h.header.replace("{{title}}",b.title):"")}),this},a.prototype.getImageSize=function(a,b){var c,d,e=this;return b==null&&(b=function(){}),d=this.images[a],!d.width||!d.height?(this.spinner.removeClass("hide"),c=new Image,c.src=d.source,c.onload=function(d){return e.spinner.addClass("hide"),e.images[a].width=c.width,e.images[a].height=c.height,delete c,b.call(e,a)}):b.call(this,a)},a.prototype.updateDimensions=function(a,b){var c,d,e,f,g,h,i,j;return g=!this.options.thumbnails||this.thumbnails.css("display")==="none"?0:this.thumbnails.height(),d=window.innerWidth,j=d-50,c=window.innerHeight,i=c-50-g,a>j&&(b=j*b/a,a=j),b>i&&(a=i*a/b,b=i),e=parseInt(a/2,10),h=parseInt(b/2,10),g>0&&(h+=parseInt(g/2,10)),f={width:d/2-e+"px",height:c+"px"},this.leftside.css(f),this.rightside.css(f),f={width:a,height:b,"margin-left":"-"+e+"px","margin-top":"-"+h+"px"},this.container.css(f),this.spinner.css(f),this},a.prototype.createThumbnails=function(){var a,b,c,d,e,f,g;if(!this.options.thumbnails||!this.current||this.images.length<=1)return this;g=this,c=this.images[this.current],b="",f=this.images;for(a in f)d=f[a],e=c.source!=null===d.source?" selected":"",b+=h.thumbnail.replace("{{selected}}",e).replace("{{cid}}",a).replace("{{thumbnail}}",d.thumbnail).replace("{{title}}",d.title?' title="'+d.title+'"':"");return this.thumbnails.html(b).find(".sgl-thumbnail").click(function(a){return g.updateImage(parseInt($(this).attr("data-cid"),10))}),this.overlay.find(".sgl-thumbnails-toggle").click(function(a){var b;return b=g.thumbnails.hasClass("hide")?"removeClass":"addClass",g.thumbnails[b]("hide"),$(this)[b]("hide"),g.updateDimensions(c.width,c.height)}),this},a}(),window.sglGallery=a,jQuery&&jQuery.fn&&(jQuery.fn.gallery=function(){return new a(this,arguments[0])})})).call(this)